<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poland Bulldogs Schedule</title>
  <style>
    :root {
      --primary: #00328f;
      --ink: #0f172a;
      --muted: #64748b;
      --bg: #f6f7fb;
      --card: #ffffff;
      --radius: 12px;
      --ring: 0 0 0 2px rgba(0,50,143,.15);
      --shadow: 0 8px 20px rgba(2, 6, 23, 0.08);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* App Bar */
    .appbar {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: saturate(180%) blur(10px);
      background: rgba(255,255,255,.8);
      border-bottom: 1px solid rgba(15,23,42,.06);
    }
    .appbar-inner {
      display: flex;
      align-items: center;
      gap: .75rem;
      padding: .75rem 1rem;
      max-width: 980px;
      margin: 0 auto;
    }
    .brand {
      display: flex; align-items: center; gap: .5rem;
    }
    .brand img { height: 28px; }
    .brand h1 { font-size: 1rem; margin: 0; letter-spacing: .2px; font-weight: 700; color: var(--primary); }

    /* Tabs */
    .tabs { display: flex; gap: .25rem; margin-left: auto; }
    .tab {
      appearance: none; border: none; background: transparent; color: var(--muted);
      padding: .4rem .7rem; border-radius: 999px; cursor: pointer; font-weight: 600; font-size: .9rem;
    }
    .tab.active { color: #fff; background: var(--primary); box-shadow: var(--ring); }

    /* Filters row */
    .filters {
      position: sticky; top: 56px; z-index: 19; background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.92));
      border-bottom: 1px solid rgba(15,23,42,.06);
      overflow-x: hidden;
    }
    .filters-inner {
      max-width: 980px;
      margin: 0 auto;
      padding: .5rem 1rem;
      display: grid;
      gap: .5rem;
      overflow-x: hidden;
    }

    /* Date scroller */
    .date-strip { display: flex; align-items: center; gap: .5rem; width: 100%; overflow: hidden; }

    .date-strip .datescroll { flex: 1; min-width: 0; }
    .date-btn { border: none; background: var(--card); border-radius: var(--radius); padding: .5rem; box-shadow: var(--shadow); cursor: pointer; }
    .datescroll {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: max-content;
      gap: .5rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .datescroll::-webkit-scrollbar { display: none; }
    .sports {
      display: flex;
      gap: .4rem;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .sports::-webkit-scrollbar { display: none; }
    .chip {
      padding: .45rem .7rem; background: #fff; border: 1px solid rgba(15,23,42,.08); border-radius: 999px; font-size: .85rem; font-weight: 600; color: var(--muted);
      white-space: nowrap; cursor: pointer; transition: transform .12s ease; flex: 0 0 auto;
    }
    @media (max-width: 720px) {
      body[data-view="all"] .date-header { position: static; top: auto; }
    }
    .chip:active { transform: scale(.98); }
    .chip.active { color: var(--primary); border-color: rgba(0,50,143,.35); background: #f1f5ff; }

    /* Sport chips */
    .sports::-webkit-scrollbar { display: none; }
    .sports::-webkit-scrollbar { display: none; }

    /* Content */
    .container { max-width: 980px; margin: .75rem auto 6rem; padding: 0 1rem; }

    /* Cards */
    .card {
      background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); padding: .9rem; display: grid; gap: .5rem; border: 1px solid rgba(15,23,42,.06);
    }
    .card + .date-header { margin-top: 1rem; }
    .stack { display: grid; gap: .6rem; }
    .date-header { position: sticky; top: 106px; z-index: 10; background: transparent; margin: .75rem 0 .5rem; }
    .date-header h3 { margin: 0; font-size: .95rem; color: var(--muted); font-weight: 700; letter-spacing: .2px; }

    .row { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: .5rem; }
    .title { font-weight: 800; letter-spacing: .2px; }
    .meta { font-size: .9rem; color: var(--muted); }
    .badge { padding: .2rem .5rem; border-radius: 999px; font-size: .75rem; font-weight: 800; letter-spacing: .3px; border: 1px solid rgba(15,23,42,.08); }
    .badge.home { color: #065f46; background: #ecfdf5; border-color: #a7f3d0; }
    .badge.away { color: #7c2d12; background: #fff7ed; border-color: #fed7aa; }
    .badge.cancelled { color: #991b1b; background: #fee2e2; border-color: #fecaca; }
    .badge.postponed { color: #92400e; background: #ffedd5; border-color: #fed7aa; }

    .actions { display: flex; align-items: center; gap: .5rem; }
    .btn { border: 1px solid rgba(15,23,42,.08); background: #fff; border-radius: 10px; padding: .45rem .6rem; font-weight: 700; font-size: .85rem; cursor: pointer; }
    .btn:focus-visible { box-shadow: var(--ring); outline: none; }

    /* FAB */
    .fab { position: fixed; right: 16px; bottom: 16px; background: var(--primary); color: #fff; border: none; border-radius: 999px; padding: .8rem 1rem; font-weight: 800; box-shadow: 0 10px 30px rgba(0,50,143,.35); cursor: pointer; z-index: 30; }

    /* Empty */
    .empty { text-align: center; color: var(--muted); padding: 2rem 1rem; }

    /* Desktop tweaks */
    @media (min-width: 720px) {
      .row { grid-template-columns: 2fr auto; }
    }
  </style>
</head>
<body>
  <header class="appbar">
    <div class="appbar-inner">
      <div class="brand">
        <img src="https://www.polandbulldogs.com/uploaded/emails/bulldog-logo.png" alt="Poland Bulldogs Logo" />
        <h1>Poland Athletics</h1>
      </div>
      <nav class="tabs">
        <button class="tab" data-view="today">Today</button>
        <button class="tab" data-view="week">Week</button>
        <button class="tab" data-view="month">Month</button>
        <button class="tab" data-view="all">All</button>
      </nav>
    </div>
  </header>

  <section class="filters">
    <div class="filters-inner">
      <div class="date-strip">
        <button class="date-btn" id="prevDay" aria-label="Previous day">&#8592;</button>
        <div id="dateScroll" class="datescroll" role="tablist" aria-label="Pick a date"></div>
        <button class="date-btn" id="nextDay" aria-label="Next day">&#8594;</button>
      </div>
      <div id="sportChips" class="sports" aria-label="Filter by sport"></div>
    </div>
  </section>

  <main class="container">
    <div id="list" class="stack" aria-live="polite"></div>
  </main>

  <button id="fabToday" class="fab">Today</button>

  <script>
    // -------- Data + State --------
    const listEl = document.getElementById('list');
    const dateScroll = document.getElementById('dateScroll');
    const sportChips = document.getElementById('sportChips');
    const tabs = [...document.querySelectorAll('.tab')];
    const fabToday = document.getElementById('fabToday');
    const prevDay = document.getElementById('prevDay');
    const nextDay = document.getElementById('nextDay');

    let allGames = [];
    let currentDate = new Date();
    let view = getHashView();
    let selectedSport = '';

    function getHashView(){
      const hash = location.hash.replace('#','').toLowerCase();
      return ['today','week','month','all'].includes(hash) ? hash : 'week';
    }

    function fmtDate(d, opts){ return new Intl.DateTimeFormat(undefined, opts).format(d); }

    function parseGameDate(g){
      if(!g || !g.date){ return null; }
      const dtStr = g.time ? `${g.date} ${g.time}` : `${g.date} 12:00 AM`;
      const d = new Date(dtStr);
      return isNaN(d) ? null : d;
    }
    function stripTime(d){ const x = new Date(d); x.setHours(0,0,0,0); return x; }
    const safe = (v,f='') => (v ?? '').toString().trim() || f;

    // -------- Load --------
    load();
    async function load(){
      listEl.innerHTML = '<div class="empty">Loadingâ€¦</div>';
      try {
        const res = await fetch('dist/data/combined.json', { cache: 'no-cache' });
        allGames = await res.json();
      } catch(e){
        listEl.innerHTML = '<div class="empty">Could not load schedule.</div>';
        return;
      }
      buildSportChips();
      buildDateStrip(currentDate);
      syncTabs();
      render();
    }

    // -------- UI Builders --------
    function buildSportChips(){
      const sports = [...new Set(allGames.map(g => g.sport).filter(Boolean))].sort();
      sportChips.innerHTML = '';
      const allChip = chipEl('All Sports', '', selectedSport === '');
      sportChips.appendChild(allChip);
      sports.forEach(s => sportChips.appendChild(chipEl(s, s, selectedSport === s)));
    }
    function chipEl(label, value, active){
      const el = document.createElement('button');
      el.className = 'chip' + (active ? ' active' : '');
      el.setAttribute('role','checkbox');
      el.setAttribute('aria-checked', active ? 'true' : 'false');
      el.textContent = label;
      el.addEventListener('click', () => { selectedSport = value; buildSportChips(); render(); });
      return el;
    }

    function buildDateStrip(anchor){
      // Build a 14-day strip centered on anchor
      const start = new Date(stripTime(anchor));
      start.setDate(start.getDate() - 3);
      dateScroll.innerHTML = '';
      for(let i=0;i<14;i++){
        const d = new Date(start); d.setDate(start.getDate()+i);
        const b = document.createElement('button');
        b.className = 'chip' + (stripTime(d).getTime() === stripTime(currentDate).getTime() && view==='today' ? ' active' : '');
        b.innerHTML = `<strong>${fmtDate(d,{weekday:'short'})}</strong> ${fmtDate(d,{month:'short', day:'numeric'})}`;
        b.addEventListener('click', () => { currentDate = d; view = 'today'; syncTabs(); render(); });
        dateScroll.appendChild(b);
      }
    }

    // -------- Interactions --------
    tabs.forEach(t => t.addEventListener('click', () => { view = t.dataset.view; location.hash = view; syncTabs(); render(); }));
    window.addEventListener('hashchange', () => { view = getHashView(); syncTabs(); render(); });
    fabToday.addEventListener('click', () => { currentDate = new Date(); view = 'today'; buildDateStrip(currentDate); syncTabs(); render(); });
    prevDay.addEventListener('click', () => { currentDate.setDate(currentDate.getDate()-1); view = 'today'; buildDateStrip(currentDate); syncTabs(); render(); });
    nextDay.addEventListener('click', () => { currentDate.setDate(currentDate.getDate()+1); view = 'today'; buildDateStrip(currentDate); syncTabs(); render(); });

    function syncTabs(){
      tabs.forEach(t => t.classList.toggle('active', t.dataset.view === view));
      document.body.setAttribute('data-view', view);
    }

    // -------- Data views --------
    function inRange(g){
      const d = parseGameDate(g);
      if(!d) return false;
      const today = stripTime(currentDate);
      // Always ignore past events
      if(d < today) return false;

      if(view==='today') return stripTime(d).getTime() === today.getTime();
      if(view==='week') { 
        const end = new Date(today); 
        end.setDate(end.getDate()+7); 
        return d >= today && d < end; 
      }
      if(view==='month') { 
        return d.getMonth()===today.getMonth() && d.getFullYear()===today.getFullYear(); 
      }
      // 'all' = upcoming from today onward
      return d >= today;
    }

    function sortGames(a,b){
      const da = parseGameDate(a), db = parseGameDate(b);
      if(da && db){ if(da - db !== 0) return da - db; }
      else if(da && !db) return -1; else if(!da && db) return 1;
      const sa = safe(a.sport), sb = safe(b.sport); if(sa!==sb) return sa.localeCompare(sb);
      return safe(a.opponent).localeCompare(safe(b.opponent));
    }

    function render(){
      const filtered = allGames.filter(g => (!selectedSport || g.sport===selectedSport) && inRange(g)).sort(sortGames);
      if(filtered.length===0){ listEl.innerHTML = '<div class="empty">No events for this view.</div>'; return; }

      // Group by date
      const byDate = new Map();
      for(const g of filtered){
        const d = parseGameDate(g);
        const key = d ? fmtDate(d,{weekday:'long', month:'long', day:'numeric'}) : 'Date TBD';
        if(!byDate.has(key)) byDate.set(key, []);
        byDate.get(key).push(g);
      }

      listEl.innerHTML = '';
      for(const [label, games] of byDate){
        const hdr = document.createElement('div');
        hdr.className = 'date-header';
        hdr.innerHTML = `<h3>${label}</h3>`;
        listEl.appendChild(hdr);
        games.forEach(g => listEl.appendChild(cardFor(g)));
      }
    }

    function cardFor(g){
      const d = parseGameDate(g);
      const time = d ? fmtDate(d,{ hour: 'numeric', minute: '2-digit'}) : 'TBD';
      const sport = safe(g.sport,'Sport');
      const hoa = safe(g.homeOrAway).toLowerCase();
      const vsAt = safe(g.vsOrAt, hoa==='home' ? 'vs.' : 'at');
      const opponent = safe(g.opponent,'Opponent TBD');
      const location = safe(g.location,'Location TBD');
      const result = safe(g.result,'');

      const status = g.isCancelled ? 'cancelled' : g.isPostponed ? 'postponed' : hoa==='home' ? 'home' : 'away';
      const statusLabel = g.isCancelled ? 'Cancelled' : g.isPostponed ? 'Postponed' : hoa==='home' ? 'Home' : 'Away';

      const el = document.createElement('article');
      el.className = 'card';
      el.innerHTML = `
        <div class="row">
          <div class="title">${sport} <span class="meta">${vsAt} ${opponent}</span></div>
          <span class="badge ${status}">${statusLabel}</span>
        </div>
        <div class="row">
          <div class="meta">${time} Â· ${location}${result ? ` Â· Result: ${result}` : ''}</div>
          <div class="actions">
            <button class="btn" aria-label="Add to calendar" title="Add to calendar">ðŸ“…</button>
          </div>
        </div>`;
      const btn = el.querySelector('.btn');
      btn.addEventListener('click', () => {
        // Build a simple ICS link for this event
        const start = d ? d.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z' : '';
        const endDate = d ? new Date(d.getTime() + 2*60*60*1000) : null;
        const end = endDate ? endDate.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z' : start;
        const ics = `BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${sport} ${vsAt} ${opponent}
DTSTART:${start}
DTEND:${end}
LOCATION:${location}
DESCRIPTION:${sport} ${vsAt} ${opponent} at ${location}
END:VEVENT
END:VCALENDAR`;
        const blob = new Blob([ics], {type: 'text/calendar'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${sport}-${opponent}.ics`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });
      return el;
    }
  </script>
</body>
</html>